document.getElementById('results').innerHTML = "";

document.querySelector('#results').insertAdjacentHTML("afterbegin", "<%= j (render partial: './partials/results') %>") ;

$(document).ready(function() {
    $(".selectpicker").selectpicker("refresh");
    $('select').attr('disabled', true);//disables select options

     var arrData=[];


$(document).on('click','.checkBoxClass',function () {
    // Delete object when unchecked
    if($(this). prop('checked') == false){
        var gameObject_id = $(this).closest('tr').find('td:eq(1)').text().replace(/[\W_]/g, '');
        arrData = arrData.filter(item => item.id !== gameObject_id);
        console.log(arrData);
    }


    if($(this).prop('checked') == true) {
        $(this).closest('tr').find('select').attr('disabled', false); //makes select options enabled again
        var gameObject = {};
        var gamePlatforms;
        var gameStores;
        gameObject.id = $(this).closest('tr').find('td:eq(1)').text().replace(/[\W_]/g, '');
        gameObject.name = $(this).closest('tr').find('td:eq(3)').text().replace(/[\r\n]+/g, ' ').trim();
        gameObject.date = $(this).closest('tr').find('td:eq(4)').text().replace(/[\r\n]+/g, ' ').trim();
        gameObject.platform = gamePlatforms;
        gameObject.stores = gameStores;


        arrData = [gameObject, ...arrData];

        $(this).closest( 'tr').find('.platformSelector').change(function() {
            var $this = $(this);
            var gamePlatforms2 = [];

            $(this).find('.platformSelector option:selected').toArray().map(function(item){ 
                var newObj = {};
                newObj.id = item.dataset.object;
                newObj.platform = item.text;
                gamePlatforms2.push(newObj);
            }
            ).join();
            gamePlatforms = gamePlatforms2;
        });

        $(this).closest('tr').find('.storeSelector').change(function(){
            var $this = $(this);
            var gameStores2 = [];
            $(this).find(".storeSelector option:selected").toArray().map(function (item) {
                     var newObj = {};
                     newObj.id = item.dataset.object;
                     newObj.store = item.text;
                     gameStores2.push(newObj);
              }).join();
            gameStores = gameStores2;
        })
        }
        console.log(arrData);
    });
});