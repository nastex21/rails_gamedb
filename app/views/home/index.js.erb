document.getElementById('results').innerHTML = "";

document.querySelector('#results').insertAdjacentHTML("afterbegin", "<%= j (render partial: './partials/results') %>") ;

$(document).ready(function() {
    $(".selectpicker").selectpicker("refresh");

     var arrData=[];
     var gamePlatforms = [];
     var gameStores = [];


$(document).on('click','.checkBoxClass',function () {
    // Delete object when unchecked
    if($(this). prop('checked') == false){
        var gameObject_id = $(this).closest('tr').find('td:eq(1)').text().replace(/[\W_]/g, '');
        arrData = arrData.filter(item => item.id !== gameObject_id);
        console.log(arrData);
    }

    if($(this).prop('checked') == true) {
        $(this).closest('tr').find('select').attr('disabled', false); //makes select options disabled 
        var gameObject = {};
        gameObject.id = $(this).closest('tr').find('td:eq(1)').text().replace(/[\W_]/g, '');
        gameObject.name = $(this).closest('tr').find('td:eq(3)').text().replace(/[\r\n]+/g, ' ').trim();
        gameObject.date = $(this).closest('tr').find('td:eq(4)').text().replace(/[\r\n]+/g, ' ').trim();
        gameObject.platform = gamePlatforms;
        gameObject.stores = gameStores;

        arrData = [gameObject, ...arrData];
        var $this;

        $(this).closest('tr').find(".platformSelector option:selected").each(function () {
            $this = $(this);

            console.log('something');
            if ($this.length) {
                console.log($this);
                var newText = $this.text().replace(/[\W_]/g, '');
                var newObj = {};
                newObj.id = $(this).data("object");
                newObj.platform = newText;
                gamePlatforms.push(newObj);
                console.log(arrData);
            }
         });

         $(this).closest('tr').find(".storeSelector option:selected").each(function () {
            $this = $(this);
            if ($this.length) {
                var newText = $this.text().replace(/[\W_]/g, '');
                var newObj = {};
                newObj.id = $(this).data("object");
                newObj.store = newText;
                gameStores.push(newObj);
                console.log(arrData);
            }
         });

        }

        $( ".platformSelector" ).change(function() {
            var newText = $this.text().replace(/[\W_]/g, '');
            console.log(newText);

        });
        console.log(arrData);
    });
});